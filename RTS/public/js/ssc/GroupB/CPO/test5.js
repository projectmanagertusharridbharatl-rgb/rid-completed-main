const questions = [
  {
       "num": 1,
        "question_en": "What is 30 × 15?",
        "question_hi": "30 × 15 कितना होगा?",
        "options_en": [
            "440",
            "460",
            "455",
            "450"
        ],
        "options_hi": [
            "440",
            "460",
            "455",
            "450"
        ],
        "answer_en": "450",
        "answer_hi": "450",
        "attempted": false,
        "selected": ""
    },
    {
       "num": 2,
        "question_en": "What is 89 × 4?",
        "question_hi": "89 × 4 कितना होगा?",
        "options_en": [
            "346",
            "361",
            "356",
            "366"
        ],
        "options_hi": [
            "346",
            "361",
            "356",
            "366"
        ],
        "answer_en": "356",
        "answer_hi": "356",
        "attempted": false,
        "selected": ""
    },
    {
       "num": 3,
        "question_en": "What is 73 × 16?",
        "question_hi": "73 × 16 कितना होगा?",
        "options_en": [
            "1173",
            "1158",
            "1168",
            "1178"
        ],
        "options_hi": [
            "1173",
            "1158",
            "1168",
            "1178"
        ],
        "answer_en": "1168",
        "answer_hi": "1168",
        "attempted": false,
        "selected": ""
    },
    {
       "num": 4,
        "question_en": "What is 63 × 16?",
        "question_hi": "63 × 16 कितना होगा?",
        "options_en": [
            "1013",
            "1008",
            "998",
            "1018"
        ],
        "options_hi": [
            "1013",
            "1008",
            "998",
            "1018"
        ],
        "answer_en": "1008",
        "answer_hi": "1008",
        "attempted": false,
        "selected": ""
    },
    {
       "num": 5,
        "question_en": "What is 47 × 11?",
        "question_hi": "47 × 11 कितना होगा?",
        "options_en": [
            "517",
            "527",
            "522",
            "507"
        ],
        "options_hi": [
            "517",
            "527",
            "522",
            "507"
        ],
        "answer_en": "517",
        "answer_hi": "517",
        "attempted": false,
        "selected": ""
    },
    {
       "num": 6,
        "question_en": "What is 57 × 10?",
        "question_hi": "57 × 10 कितना होगा?",
        "options_en": [
            "575",
            "580",
            "570",
            "560"
        ],
        "options_hi": [
            "575",
            "580",
            "570",
            "560"
        ],
        "answer_en": "570",
        "answer_hi": "570",
        "attempted": false,
        "selected": ""
    },
    {
       "num": 7,
        "question_en": "What is 41 × 7?",
        "question_hi": "41 × 7 कितना होगा?",
        "options_en": [
            "292",
            "277",
            "287",
            "297"
        ],
        "options_hi": [
            "292",
            "277",
            "287",
            "297"
        ],
        "answer_en": "287",
        "answer_hi": "287",
        "attempted": false,
        "selected": ""
    },
    {
       "num": 8,
        "question_en": "What is 46 × 20?",
        "question_hi": "46 × 20 कितना होगा?",
        "options_en": [
            "910",
            "920",
            "925",
            "930"
        ],
        "options_hi": [
            "910",
            "920",
            "925",
            "930"
        ],
        "answer_en": "920",
        "answer_hi": "920",
        "attempted": false,
        "selected": ""
    },
    {
       "num": 9,
        "question_en": "What is 60 × 10?",
        "question_hi": "60 × 10 कितना होगा?",
        "options_en": [
            "605",
            "600",
            "590",
            "610"
        ],
        "options_hi": [
            "605",
            "600",
            "590",
            "610"
        ],
        "answer_en": "600",
        "answer_hi": "600",
        "attempted": false,
        "selected": ""
    },
    {
       "num": 10,
        "question_en": "What is 93 × 5?",
        "question_hi": "93 × 5 कितना होगा?",
        "options_en": [
            "475",
            "455",
            "465",
            "470"
        ],
        "options_hi": [
            "475",
            "455",
            "465",
            "470"
        ],
        "answer_en": "465",
        "answer_hi": "465",
        "attempted": false,
        "selected": ""
    },
    {
       "num": 11,
        "question_en": "What is 10 × 17?",
        "question_hi": "10 × 17 कितना होगा?",
        "options_en": [
            "170",
            "160",
            "175",
            "180"
        ],
        "options_hi": [
            "170",
            "160",
            "175",
            "180"
        ],
        "answer_en": "170",
        "answer_hi": "170",
        "attempted": false,
        "selected": ""
    },
    {
       "num": 12,
        "question_en": "What is 15 × 11?",
        "question_hi": "15 × 11 कितना होगा?",
        "options_en": [
            "170",
            "155",
            "165",
            "175"
        ],
        "options_hi": [
            "170",
            "155",
            "165",
            "175"
        ],
        "answer_en": "165",
        "answer_hi": "165",
        "attempted": false,
        "selected": ""
    },
    {
       "num": 13,
        "question_en": "What is 34 × 20?",
        "question_hi": "34 × 20 कितना होगा?",
        "options_en": [
            "670",
            "685",
            "680",
            "690"
        ],
        "options_hi": [
            "670",
            "685",
            "680",
            "690"
        ],
        "answer_en": "680",
        "answer_hi": "680",
        "attempted": false,
        "selected": ""
    },
    {
       "num": 14,
        "question_en": "What is 75 × 7?",
        "question_hi": "75 × 7 कितना होगा?",
        "options_en": [
            "525",
            "535",
            "515",
            "530"
        ],
        "options_hi": [
            "525",
            "535",
            "515",
            "530"
        ],
        "answer_en": "525",
        "answer_hi": "525",
        "attempted": false,
        "selected": ""
    },
    {
       "num": 15,
        "question_en": "What is 95 × 2?",
        "question_hi": "95 × 2 कितना होगा?",
        "options_en": [
            "195",
            "200",
            "180",
            "190"
        ],
        "options_hi": [
            "195",
            "200",
            "180",
            "190"
        ],
        "answer_en": "190",
        "answer_hi": "190",
        "attempted": false,
        "selected": ""
    },
    {
       "num": 16,
        "question_en": "What is 37 × 3?",
        "question_hi": "37 × 3 कितना होगा?",
        "options_en": [
            "116",
            "111",
            "121",
            "101"
        ],
        "options_hi": [
            "116",
            "111",
            "121",
            "101"
        ],
        "answer_en": "111",
        "answer_hi": "111",
        "attempted": false,
        "selected": ""
    },
    {
       "num": 17,
        "question_en": "What is 15 × 8?",
        "question_hi": "15 × 8 कितना होगा?",
        "options_en": [
            "130",
            "125",
            "120",
            "110"
        ],
        "options_hi": [
            "130",
            "125",
            "120",
            "110"
        ],
        "answer_en": "120",
        "answer_hi": "120",
        "attempted": false,
        "selected": ""
    },
    {
       "num": 18,
        "question_en": "What is 11 × 12?",
        "question_hi": "11 × 12 कितना होगा?",
        "options_en": [
            "132",
            "142",
            "122",
            "137"
        ],
        "options_hi": [
            "132",
            "142",
            "122",
            "137"
        ],
        "answer_en": "132",
        "answer_hi": "132",
        "attempted": false,
        "selected": ""
    },
    {
       "num": 19,
        "question_en": "What is 33 × 11?",
        "question_hi": "33 × 11 कितना होगा?",
        "options_en": [
            "373",
            "353",
            "368",
            "363"
        ],
        "options_hi": [
            "373",
            "353",
            "368",
            "363"
        ],
        "answer_en": "363",
        "answer_hi": "363",
        "attempted": false,
        "selected": ""
    },
    {
       "num": 20,
        "question_en": "What is 73 × 19?",
        "question_hi": "73 × 19 कितना होगा?",
        "options_en": [
            "1377",
            "1397",
            "1387",
            "1392"
        ],
        "options_hi": [
            "1377",
            "1397",
            "1387",
            "1392"
        ],
        "answer_en": "1387",
        "answer_hi": "1387",
        "attempted": false,
        "selected": ""
    },
    {
       "num": 21,
        "question_en": "What is 22 × 14?",
        "question_hi": "22 × 14 कितना होगा?",
        "options_en": [
            "313",
            "308",
            "298",
            "318"
        ],
        "options_hi": [
            "313",
            "308",
            "298",
            "318"
        ],
        "answer_en": "308",
        "answer_hi": "308",
        "attempted": false,
        "selected": ""
    },
    {
       "num": 22,
        "question_en": "What is 93 × 7?",
        "question_hi": "93 × 7 कितना होगा?",
        "options_en": [
            "651",
            "661",
            "641",
            "656"
        ],
        "options_hi": [
            "651",
            "661",
            "641",
            "656"
        ],
        "answer_en": "651",
        "answer_hi": "651",
        "attempted": false,
        "selected": ""
    },
    {
      "num": 23,
        "question_en": "What is 62 × 11?",
        "question_hi": "62 × 11 कितना होगा?",
        "options_en": [
            "687",
            "682",
            "692",
            "672"
        ],
        "options_hi": [
            "687",
            "682",
            "692",
            "672"
        ],
        "answer_en": "682",
        "answer_hi": "682",
        "attempted": false,
        "selected": ""
    },
    {
      "num": 24,
        "question_en": "What is 49 × 20?",
        "question_hi": "49 × 20 कितना होगा?",
        "options_en": [
            "980",
            "985",
            "990",
            "970"
        ],
        "options_hi": [
            "980",
            "985",
            "990",
            "970"
        ],
        "answer_en": "980",
        "answer_hi": "980",
        "attempted": false,
        "selected": ""
    },
    {
      "num": 25,
        "question_en": "What is 12 × 13?",
        "question_hi": "12 × 13 कितना होगा?",
        "options_en": [
            "156",
            "146",
            "161",
            "166"
        ],
        "options_hi": [
            "156",
            "146",
            "161",
            "166"
        ],
        "answer_en": "156",
        "answer_hi": "156",
        "attempted": false,
        "selected": ""
    },
    {
       "num": 26,
        "question_en": "What is 36 × 2?",
        "question_hi": "36 × 2 कितना होगा?",
        "options_en": [
            "62",
            "82",
            "72",
            "77"
        ],
        "options_hi": [
            "62",
            "82",
            "72",
            "77"
        ],
        "answer_en": "72",
        "answer_hi": "72",
        "attempted": false,
        "selected": ""
    },
    {
       "num": 27,
        "question_en": "What is 24 × 4?",
        "question_hi": "24 × 4 कितना होगा?",
        "options_en": [
            "96",
            "106",
            "86",
            "101"
        ],
        "options_hi": [
            "96",
            "106",
            "86",
            "101"
        ],
        "answer_en": "96",
        "answer_hi": "96",
        "attempted": false,
        "selected": ""
    },
    {
       "num": 28,
        "question_en": "What is 68 × 7?",
        "question_hi": "68 × 7 कितना होगा?",
        "options_en": [
            "481",
            "466",
            "476",
            "486"
        ],
        "options_hi": [
            "481",
            "466",
            "476",
            "486"
        ],
        "answer_en": "476",
        "answer_hi": "476",
        "attempted": false,
        "selected": ""
    },
    {
       "num": 29,
        "question_en": "What is 80 × 6?",
        "question_hi": "80 × 6 कितना होगा?",
        "options_en": [
            "470",
            "490",
            "480",
            "485"
        ],
        "options_hi": [
            "470",
            "490",
            "480",
            "485"
        ],
        "answer_en": "480",
        "answer_hi": "480",
        "attempted": false,
        "selected": ""
    },
    {
       "num": 30,
        "question_en": "What is 74 × 7?",
        "question_hi": "74 × 7 कितना होगा?",
        "options_en": [
            "518",
            "508",
            "523",
            "528"
        ],
        "options_hi": [
            "518",
            "508",
            "523",
            "528"
        ],
        "answer_en": "518",
        "answer_hi": "518",
        "attempted": false,
        "selected": ""
    },
    {
       "num": 31,
        "question_en": "What is 30 × 18?",
        "question_hi": "30 × 18 कितना होगा?",
        "options_en": [
            "545",
            "530",
            "540",
            "550"
        ],
        "options_hi": [
            "545",
            "530",
            "540",
            "550"
        ],
        "answer_en": "540",
        "answer_hi": "540",
        "attempted": false,
        "selected": ""
    },
    {
       "num": 32,
        "question_en": "What is 59 × 17?",
        "question_hi": "59 × 17 कितना होगा?",
        "options_en": [
            "993",
            "1003",
            "1008",
            "1013"
        ],
        "options_hi": [
            "993",
            "1003",
            "1008",
            "1013"
        ],
        "answer_en": "1003",
        "answer_hi": "1003",
        "attempted": false,
        "selected": ""
    },
    {
       "num": 33,
        "question_en": "What is 15 × 17?",
        "question_hi": "15 × 17 कितना होगा?",
        "options_en": [
            "260",
            "265",
            "255",
            "245"
        ],
        "options_hi": [
            "260",
            "265",
            "255",
            "245"
        ],
        "answer_en": "255",
        "answer_hi": "255",
        "attempted": false,
        "selected": ""
    },
    {
       "num": 34,
        "question_en": "What is 21 × 7?",
        "question_hi": "21 × 7 कितना होगा?",
        "options_en": [
            "147",
            "152",
            "137",
            "157"
        ],
        "options_hi": [
            "147",
            "152",
            "137",
            "157"
        ],
        "answer_en": "147",
        "answer_hi": "147",
        "attempted": false,
        "selected": ""
    },
    {
       "num": 35,
        "question_en": "What is 88 × 8?",
        "question_hi": "88 × 8 कितना होगा?",
        "options_en": [
            "714",
            "694",
            "704",
            "709"
        ],
        "options_hi": [
            "714",
            "694",
            "704",
            "709"
        ],
        "answer_en": "704",
        "answer_hi": "704",
        "attempted": false,
        "selected": ""
    },
    {
       "num": 36,
        "question_en": "What is 15 × 14?",
        "question_hi": "15 × 14 कितना होगा?",
        "options_en": [
            "210",
            "200",
            "215",
            "220"
        ],
        "options_hi": [
            "210",
            "200",
            "215",
            "220"
        ],
        "answer_en": "210",
        "answer_hi": "210",
        "attempted": false,
        "selected": ""
    },
    {
       "num": 37,
        "question_en": "What is 25 × 6?",
        "question_hi": "25 × 6 कितना होगा?",
        "options_en": [
            "155",
            "150",
            "140",
            "160"
        ],
        "options_hi": [
            "155",
            "150",
            "140",
            "160"
        ],
        "answer_en": "150",
        "answer_hi": "150",
        "attempted": false,
        "selected": ""
    },
    {
       "num": 38,
        "question_en": "What is 15 × 19?",
        "question_hi": "15 × 19 कितना होगा?",
        "options_en": [
            "290",
            "295",
            "275",
            "285"
        ],
        "options_hi": [
            "290",
            "295",
            "275",
            "285"
        ],
        "answer_en": "285",
        "answer_hi": "285",
        "attempted": false,
        "selected": ""
    },
    {
       "num": 39,
        "question_en": "What is 25 × 14?",
        "question_hi": "25 × 14 कितना होगा?",
        "options_en": [
            "350",
            "360",
            "340",
            "355"
        ],
        "options_hi": [
            "350",
            "360",
            "340",
            "355"
        ],
        "answer_en": "350",
        "answer_hi": "350",
        "attempted": false,
        "selected": ""
    },
    {
       "num": 40,
        "question_en": "What is 93 × 15?",
        "question_hi": "93 × 15 कितना होगा?",
        "options_en": [
            "1405",
            "1395",
            "1400",
            "1385"
        ],
        "options_hi": [
            "1405",
            "1395",
            "1400",
            "1385"
        ],
        "answer_en": "1395",
        "answer_hi": "1395",
        "attempted": false,
        "selected": ""
    },
    {
       "num": 41,
        "question_en": "What is 64 × 14?",
        "question_hi": "64 × 14 कितना होगा?",
        "options_en": [
            "896",
            "901",
            "906",
            "886"
        ],
        "options_hi": [
            "896",
            "901",
            "906",
            "886"
        ],
        "answer_en": "896",
        "answer_hi": "896",
        "attempted": false,
        "selected": ""
    },
    {
       "num": 42,
        "question_en": "What is 32 × 2?",
        "question_hi": "32 × 2 कितना होगा?",
        "options_en": [
            "69",
            "74",
            "54",
            "64"
        ],
        "options_hi": [
            "69",
            "74",
            "54",
            "64"
        ],
        "answer_en": "64",
        "answer_hi": "64",
        "attempted": false,
        "selected": ""
    },
    {
       "num": 43,
        "question_en": "What is 69 × 9?",
        "question_hi": "69 × 9 कितना होगा?",
        "options_en": [
            "621",
            "631",
            "611",
            "626"
        ],
        "options_hi": [
            "621",
            "631",
            "611",
            "626"
        ],
        "answer_en": "621",
        "answer_hi": "621",
        "attempted": false,
        "selected": ""
    },
    {
       "num": 44,
        "question_en": "What is 32 × 17?",
        "question_hi": "32 × 17 कितना होगा?",
        "options_en": [
            "554",
            "534",
            "544",
            "549"
        ],
        "options_hi": [
            "554",
            "534",
            "544",
            "549"
        ],
        "answer_en": "544",
        "answer_hi": "544",
        "attempted": false,
        "selected": ""
    },
    {
       "num": 45,
        "question_en": "What is 26 × 13?",
        "question_hi": "26 × 13 कितना होगा?",
        "options_en": [
            "328",
            "338",
            "348",
            "343"
        ],
        "options_hi": [
            "328",
            "338",
            "348",
            "343"
        ],
        "answer_en": "338",
        "answer_hi": "338",
        "attempted": false,
        "selected": ""
    },
    {
       "num": 46,
        "question_en": "What is 66 × 18?",
        "question_hi": "66 × 18 कितना होगा?",
        "options_en": [
            "1198",
            "1178",
            "1193",
            "1188"
        ],
        "options_hi": [
            "1198",
            "1178",
            "1193",
            "1188"
        ],
        "answer_en": "1188",
        "answer_hi": "1188",
        "attempted": false,
        "selected": ""
    },
    {
       "num": 47,
        "question_en": "What is 20 × 12?",
        "question_hi": "20 × 12 कितना होगा?",
        "options_en": [
            "230",
            "250",
            "245",
            "240"
        ],
        "options_hi": [
            "230",
            "250",
            "245",
            "240"
        ],
        "answer_en": "240",
        "answer_hi": "240",
        "attempted": false,
        "selected": ""
    },
    {
       "num": 48,
        "question_en": "What is 93 × 6?",
        "question_hi": "93 × 6 कितना होगा?",
        "options_en": [
            "568",
            "548",
            "563",
            "558"
        ],
        "options_hi": [
            "568",
            "548",
            "563",
            "558"
        ],
        "answer_en": "558",
        "answer_hi": "558",
        "attempted": false,
        "selected": ""
    },
    {
       "num": 49,
        "question_en": "What is 34 × 6?",
        "question_hi": "34 × 6 कितना होगा?",
        "options_en": [
            "194",
            "204",
            "214",
            "209"
        ],
        "options_hi": [
            "194",
            "204",
            "214",
            "209"
        ],
        "answer_en": "204",
        "answer_hi": "204",
        "attempted": false,
        "selected": ""
    },
    {
       "num": 50,
        "question_en": "What is 97 × 9?",
        "question_hi": "97 × 9 कितना होगा?",
        "options_en": [
            "878",
            "863",
            "883",
            "873"
        ],
        "options_hi": [
            "878",
            "863",
            "883",
            "873"
        ],
        "answer_en": "873",
        "answer_hi": "873",
        "attempted": false,
        "selected": ""
    }
];



let currentQuestion = 0; 
let language = "en";
// let timeLeft = 180 * 60; // 180 minutes
let timeLeft = 60 * 60; // 60 minutes
let timerInterval;

// ----------------- Quiz Logic -----------------
function loadQuestion(index) {
    const q = questions[index];
    document.getElementById("question").textContent = `${q.num}. ${
        language === "en" ? q.question_en : q.question_hi
    }`;
    document.getElementById("questionCounter").textContent = `Question ${index + 1} of ${questions.length}`;

    const optionsElement = document.getElementById("options");
    optionsElement.innerHTML = "";

    const options = language === "en" ? q.options_en : q.options_hi;

    options.forEach((option) => {
        const isSelected = q.selected === option;
        const optionDiv = document.createElement("div");
        optionDiv.className = "option-box";
        optionDiv.style = `
            border: 2px solid ${isSelected ? "#007bff" : "#ccc"};
            background-color: ${isSelected ? "#e7f1ff" : "white"};
            padding: 10px;
            border-radius: 8px;
            margin: 6px 0;
            cursor: pointer;
            transition: all 0.2s;
        `;

        optionDiv.innerHTML = `
            <input type="radio" name="option" value="${option}" ${isSelected ? "checked" : ""} style="margin-right:8px;">
            ${option}
        `;

        optionDiv.addEventListener("click", () => {
            markAttempted(index, option);
            loadQuestion(index);
        });

        optionsElement.appendChild(optionDiv);
    });

    updateNavigation();
}

function markAttempted(index, selectedAnswer) {
    questions[index].attempted = true;
    questions[index].selected = selectedAnswer;
    updateNavigation();
}

function nextQuestion() {
    if (currentQuestion < questions.length - 1) {
        currentQuestion++;
        loadQuestion(currentQuestion);
    }
}

function prevQuestion() {
    if (currentQuestion > 0) {
        currentQuestion--;
        loadQuestion(currentQuestion);
    }
}

function changeLanguage() {
    language = document.getElementById("languageSelect").value;
    loadQuestion(currentQuestion);
}

function submitQuiz() {
    clearInterval(timerInterval);
    let attempted = 0,
        notAttempted = 0,
        score = 0;

    questions.forEach((q) => {
        if (q.attempted) {
            attempted++;
            if (q.selected === q.answer_en || q.selected === q.answer_hi) score++;
        } else notAttempted++;
    });

    alert(
        `Quiz submitted!\nAttempted: ${attempted}\nNot Attempted: ${notAttempted}\nScore: ${score}/${questions.length}`
    );
}

function startTimer() {
    const timerElement = document.getElementById("timer");
    clearInterval(timerInterval);
    timerInterval = setInterval(() => {
        if (timeLeft <= 0) {
            clearInterval(timerInterval);
            alert("Time's up!");
            submitQuiz();
        } else {
            const hours = Math.floor(timeLeft / 3600);
            const minutes = Math.floor((timeLeft % 3600) / 60);
            const seconds = timeLeft % 60;
            timerElement.textContent = `Time Left: ${hours
                .toString()
                .padStart(2, "0")}:${minutes
                .toString()
                .padStart(2, "0")}:${seconds.toString().padStart(2, "0")}`;
            timeLeft--;
        }
    }, 1000);
}



////////////////////////////////////////////////////////////////////////////////////////////

// submit 
function jumpToQuestion(index) {
            currentQuestion = index;
            loadQuestion(index);
        }

        function submitQuiz() {
            let confirmation = confirm("Are you sure you want to submit the test?");
            
            if (!confirmation) {
                return; // अगर यूज़र 'Cancel' करता है तो आगे नहीं बढ़ेंगे
            }

            let attempted = 0;
            let notAttempted = 0;
            let score = 0;
            const results = [];

            questions.forEach(q => {
                if (q.attempted) {
                    attempted++;
                    if (q.selected === q.answer) {
                        score++;
                    }
                } else {
                    notAttempted++;
                }
                results.push({ question: q.question, selected: q.selected || "Not Answered", correct: q.answer });
            });

            localStorage.setItem("attempted", attempted);
            localStorage.setItem("notAttempted", notAttempted);
            localStorage.setItem("score", score);
            localStorage.setItem("results", JSON.stringify(results));

            // रिजल्ट देखने से पहले एक और कन्फर्मेशन ले सकते हैं
            let viewResult = confirm("Test submitted successfully! Do you want to view your result?");
            if (viewResult) {
                window.location.href = "/RTS/public/Deshbord/category/test/submit-test.html";
            }
        }
        window.onload = () => {
            loadQuestion(currentQuestion);
        };


function updateNavigation() {
    const nav = document.getElementById("circleContainer");
    nav.innerHTML = "";
    questions.forEach((q, i) => {
        let color = "gray";
        if (i === currentQuestion) color = "blue";
        else if (q.attempted) color = "green";
        nav.innerHTML += `<div class='circle' style='background-color:${color}' onclick='loadQuestion(${i})'>${i + 1}</div>`;
    });
}
// ----------------- Camera & Movement Detection -----------------
let videoStream;
let movementCount = 0;

function startCamera() {
    const container = document.createElement("div");
    container.id = "camera-container";
    container.style = `
        position:fixed; top:10px; left:10px; width:130px; height:130px;
        border-radius:50%; overflow:hidden; border:3px solid red; z-index:9999;
    `;

    document.body.appendChild(container);

    const video = document.createElement("video");
    video.autoplay = true;
    video.playsinline = true;
    video.style = "width:100%; height:100%; object-fit:cover;";
    container.appendChild(video);

    navigator.mediaDevices.getUserMedia({ video: true })
        .then(stream => {
            video.srcObject = stream;
            videoStream = stream;
            detectMovement(video);
        })
        .catch(() => alert("Camera access denied!"));
}

function detectMovement(video) {
    const canvas = document.createElement("canvas");
    const ctx = canvas.getContext("2d");
    canvas.width = 160;
    canvas.height = 160;

    let lastData = null;

    setInterval(() => {
        ctx.drawImage(video, 0, 0, 160, 160);
        const data = ctx.getImageData(0, 0, 160, 160);

        if (lastData) {
            let diff = 0;
            for (let i = 0; i < data.data.length; i += 4) {
                diff += Math.abs(data.data[i] - lastData.data[i]);
            }

            if (diff > 1000000) {
                movementCount++;

                if (movementCount === 1) alert("⚠ Alert 1: No movement detected!");
                if (movementCount === 2) alert("⚠ Alert 2: Head not moving!");
                if (movementCount === 3) {
                    alert("⚠ Alert 3: Restarting test...");
                    restartTest();
                }
            }
        }
        lastData = data;

    }, 2000);
}

function restartTest() {
    if (videoStream) videoStream.getTracks().forEach(t => t.stop());

    const cam = document.getElementById("camera-container");
    if (cam) cam.remove();

    movementCount = 0;
    currentQuestion = 0;
    timeLeft = 60 * 60;

    questions.forEach(q => {
        q.attempted = false;
        q.selected = null;
    });

    loadQuestion(0);
    startTimer();
    startCamera();
}

// ----------------- Page Load -----------------
window.onload = function () {
    loadQuestion(currentQuestion);
    startTimer();
    startCamera();
};